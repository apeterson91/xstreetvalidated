---
title: "Cleanup vs. Crime: A Case Study in 4 Parts"
description: |
  A simple concept and a decent result.
author:
  - name: Adam Peterson
    url: https://apetersonsite.org
date: 10-17-2021
output:
  distill::distill_article:
    self_contained: false
bibliography: cleanup.bib
creative_commons: CC BY
categories:
  - Big Picture 
  - Cleanup vs. Crime
  - Social Capital
draft: false 
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(tidyverse)
library(lubridate)
library(sf)
library(gt)
library(mapview)
theme_set(theme_bw() + theme(text=element_text(size=22)))
```


I'm a big fan of this 
[paper](https://ajph.aphapublications.org/doi/full/10.2105/AJPH.2018.304752)
looking at how cleaning up vacant lots 
has the potential to affect crime[@moyer2019effect]. 
There's a lot to love here, and I'm hoping to use this paper as an 
excuse to explore several different ideas relevant to both
understanding the built environment and statistical methods more generally.
In this post we'll focus on a high-level
understanding of the paper while future posts will focus on (1) the measures of 
gun violence and statistical models used, (2) the assumptions and approach 
that go into the causal inference associated with this trial and finally (3),
I'll devote a post to the conceptual models at play here. Why would cleaning up
a vacant lot affect nearby gun violence, or other measures of community health? 

I'll go on to show alternative methods that could be used to analyze 
these data and the advantages they may have over the current author's approach. 
I'll leave that, however, for a different series of posts.
Hopefully this brief outline has you excited for what's to come, but for now,
let's dive into the paper!

<aside>
For related papers see [here](https://jamanetwork.com/journals/jamanetworkopen/fullarticle/2688343) and 
[here](https://www.pnas.org/content/115/12/2946.short). 
The latter paper refers to the same set of vacant lots and provides more details
on the vacant lot greening strategy and neighborhoods involved in 
[@moyer2019effect].
</aside>

# Background 

```{r greening,fig.cap="Graphic demonstration of the different cleaning interventions. Figure from 'Citywide cluster randomized trial to restore blighted vacant land...' [@Branas2946]"}
## See PNAS copyright policy here: https://www.pnas.org/content/101/34/12399
## As this blog is currently non-commercial this image is used according to 
## the following language:
## "Our guiding principle is that, while PNAS retains copyright, 
## anyone can make noncommercial use of work in PNAS without asking our 
## permission, provided that the original source is cited." 
##  Publication is cited throughout this paper as well as in this 
## figure's caption.
knitr::include_graphics('F1.jpg')
```

The authors' objective in this work is to determine whether cleaning up a 
series of vacant lots in the areas where, unfortunately, many shootings regularly
occur, could lead to a reduced rate of gun violence. 

In order to test this hypothesis, the authors randomly assign 1 of three
"interventions" to each of 110 geographically close clusters of vacant lots 
--- 541 lots in total --- spread across Philadelphia between April and June of 
2013.

The first intervention called "greening", involved "removing trash and debris, 
grading the land, planting new grass and a small number of trees to create a 
parklike setting, installing low wooden perimeter fences, and regularly 
maintaining the lot." [@moyer2019effect]. You can see a demonstration of this 
idea in Figure \@ref(fig:greening). 

The second intervention labeled "mowing", made the vacant lot not so much park-like
as just generally maintained. The description states it as 
"mowing existing grass and weeds, removing trash and debris, and regularly 
maintaining the lot." [@moyer2019effect].

The third and final "intervention" was simply
the control group, where no action was taken on the vacant lot whatsoever. 

The author's used the Philadelphia Department of Police data of 
reported shootings not involving police officers from years 2011-2015 as their
outcome of interest. You can see a sample of these data from 2015
in the neighborhood of Upper Kensington in Figure \@ref(fig:shootings).

```{r neighborhood-data}
# From https://github.com/azavea/geo-data
uk <- read_sf("~/Documents/CityData/Philly/geo-data/Neighborhoods_Philadelphia/Neighborhoods_Philadelphia.shp") %>%
  filter(MAPNAME == "Upper Kensington")  %>% 
  st_transform(4326)
```

```{r shootings,cache=T,fig.width=14,fig.height=8,fig.cap="Map of No-Officer Involved Shootings in Upper Kensington, Philadelphia during 2015. Red point indicates the occurrence of one shooting."}

shootings <- read_csv("~/Documents/CityData/Philly/Crime/shootings_2015_2020.csv") %>% 
  filter(!is.na(point_x),!is.na(point_y)) %>% 
  filter(point_x > -80,
         year==2015,
         officer_involved=="N") %>% 
  st_as_sf(coords = c("lng","lat")) %>% 
  st_set_crs(4326) %>% 
  select(year) %>% 
  st_filter(uk)

streets <- read_sf("~/Documents/CityData/Philly/CompleteStreets-shp/CompleteStreets.shp") %>% 
  st_filter(uk)

p1 <- uk %>% 
  st_join(streets,join=st_contains) %>% 
  ggplot() + 
  geom_sf(linetype=2) + 
  geom_sf(data=streets) + 
  geom_sf(data=shootings,color='red') + 
  theme_void() + 
  theme(text = element_text(size=22))

shooting_df <- tibble(street_ix = apply(st_distance(streets,shootings),2,which.min),count=1) %>% 
  group_by(street_ix) %>% count() %>% ungroup()

pltdf <- streets %>% 
  mutate(street_ix = 1:n()) %>% 
  left_join(shooting_df) %>% 
  mutate(shootings = as.numeric(replace_na(n,0)),
         shooting = factor(as.integer((shootings>=1)*1)))

## maybe save this second plot for a different post where interference effects are discussed more explicitly
#pltdf <- as_sfnetwork(pltdf)


# p2 <- pltdf %>% 
#   ggraph(layout='stress') + 
#   geom_node_point() + 
#   geom_edge_link(aes(color=shooting)) + 
#   theme_void() + 
#   scale_edge_color_manual(values=c("black","red")) + 
#   theme(legend.position='none') + 
#   labs(caption="Data pulled from OpenDataPhilly.org")

p1 
```

# Methods 

The author's used two different measures of the number of shootings each month
in and around vacant lots to determine whether their interventions 
were effective: a kernel density estimate and two --- differently sized ---
buffer counts. The author's fit two models of a similar form, estimating the 
difference in the kernel density estimate and rate, respectively as a function
of whether the observed lot density estimate or buffer count had received 
one of the two interventions during June 2013 - April, 2015.  
They also adjusted for correlation  across time, space and within clusters. 
The kernel density estimate model is shown below, but we'll leave a more 
thorough examination of it and the buffer models for a later post.


$$ 
Y_{it} := \text{# Shootings / km}^2 \text{at lot cluster } i\text{, month } t \\
$$
$$
\begin{aligned}
Y_{it} &= \beta_0 + \beta_1 \text{Greening}_i + \beta_2\text{Mowing}_i
+ \beta_3\text{Post}_t + \beta_4\text{AllTreated}_i  \\
&+ \beta_5 \text{Greening}_i \times \text{Post}_t + 
\beta_6\text{Mowing}_i \times \text{Post}_t  \\
&+ \beta_7\text{Greening}_i\times \text{AllTreated}_t + 
\beta_8\text{Mowing}_i \times \text{AllTreated}_t \\
&+ \alpha_{m(t)} + \delta_{s(i)} + \xi_{c(i)} + \epsilon_{it}
\end{aligned}
$$
<aside>
Why did the author's fit these different models? And *what* is going 
on in that equation?
We'll discuss this more in the post focused on the methods of analysis
</aside>


# Results

Converting their estimates to percent change in the number of expected
shootings, the author's determined that the monthly shootings per square kilometer
(density estimate model) decreased by 6.8 % (95\% 
[Confidence Interval](https://en.wikipedia.org/wiki/Confidence_interval):
-10.6%,-2.7%) for those lots in the greening intervention compared to the 
pre-intervention baseline
and -9.2%  (-13.2%,-4.8%) compared to baseline for those lots in the
mowing intervention. The author's estimated a similar significant result for 
the greening intervention for their buffer analysis and a *non-significant* 
change from the mowing intervention from their buffer analysis. The author's 
sought to check for "spillover effects" from their interventions using the 
second, larger buffer model and found no significant difference for 
those areas adjacent to the greening intervention and a significant decrease
in those areas adjacent to the mowing intervention. The author's state that
"these results suggest spillover benefits of vacant lot remediation, rather than 
displacement". Meaning that they took this result to be evidence that the 
interventions didn't simply push shootings to be one or two blocks away from 
where the clean-up occurred.

<aside>
A *non-significant* result here means that the author's did not think 
there was sufficient evidence to conclude that the estimated change 
was not zero. See this 
[example](https://en.wikipedia.org/wiki/Confidence_interval#Practical_example_interpretation) 
for more.
</aside>

# Conclusion 


So ... that's neat! What's the take home message? If you clean up that dirty 
parking lot near where you live, you'll disincentive crime? Well, maybe. 
As with all human endeavors, nothing is perfect and rarely simple. 
In the posts to come we'll talk more about the strengths and limitations of 
the author's approach as well as why this result is still so encouraging in 
spite of those problems. One overarching theme to keep in mind, is that this is 
a fairly cheap endeavor, just cleaning up some vacant lots, with a potentially 
huge payoff --- saving human lives! This represents both the simplicity and the 
power that I hope to show is a regular theme in building better 
built environments.


## Updates {.appendix}

I added further details on how Branas' PNAS paper [@Branas2946] is related to 
the Moyer paper [@moyer2019effect] of concern in this case study on 10/26/21.